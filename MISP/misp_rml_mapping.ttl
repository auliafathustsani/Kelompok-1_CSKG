@prefix :      <https://w3id.org/sepses/mapping/misp#> .
@prefix rr:    <http://www.w3.org/ns/r2rml#> .
@prefix rml:   <http://semweb.mmlab.be/ns/rml#> .
@prefix ql:    <http://semweb.mmlab.be/ns/ql#> .

@prefix misp:  <https://w3id.org/sepses/resource/misp/> .
@prefix ont:   <https://w3id.org/sepses/ontology/misp#> .


###############################################################################
# 1) FEED MAP — Read Feed from each JSON entry
###############################################################################

:FeedMap a rr:TriplesMap ;
    rml:logicalSource [
        rml:source "defaults.json" ;
        rml:referenceFormulation ql:JSONPath ;
        rml:iterator "$[*].Feed"
    ] ;

    rr:subjectMap [
        rr:template "https://w3id.org/sepses/resource/misp/feed/{name}" ;
        rr:class ont:Feed
    ] ;

    rr:predicateObjectMap [
        rr:predicate ont:name ;
        rr:objectMap [ rml:reference "$.name" ]
    ] ;

    rr:predicateObjectMap [
        rr:predicate ont:provider ;
        rr:objectMap [ rml:reference "$.provider" ]
    ] ;

    rr:predicateObjectMap [
        rr:predicate ont:feedURL ;
        rr:objectMap [ rml:reference "$.url" ]
    ] ;

    rr:predicateObjectMap [
        rr:predicate ont:feedFormat ;
        rr:objectMap [ rml:reference "$.source_format" ]
    ] ;

    rr:predicateObjectMap [
        rr:predicate ont:distribution ;
        rr:objectMap [ rml:reference "$.distribution" ]
    ] ;

    rr:predicateObjectMap [
        rr:predicate ont:isEnabled ;
        rr:objectMap [ rml:reference "$.enabled" ]
    ] .
    


###############################################################################
# 2) TAG MAP — Read Tag from each JSON entry
###############################################################################

:TagMap a rr:TriplesMap ;
    rml:logicalSource [
        rml:source "defaults.json" ;
        rml:referenceFormulation ql:JSONPath ;
        rml:iterator "$[*].Tag"
    ] ;

    rr:subjectMap [
        rr:template "https://w3id.org/sepses/resource/misp/tag/{name}" ;
        rr:class ont:Tag
    ] ;

    rr:predicateObjectMap [
        rr:predicate ont:name ;
        rr:objectMap [ rml:reference "$.name" ]
    ] ;

    rr:predicateObjectMap [
        rr:predicate ont:colour ;
        rr:objectMap [ rml:reference "$.colour" ]
    ] ;

    rr:predicateObjectMap [
        rr:predicate ont:exportable ;
        rr:objectMap [ rml:reference "$.exportable" ]
    ] ;

    # Link tag → its feed (same JSON index)
    rr:predicateObjectMap [
        rr:predicate ont:hasTag ;
        rr:objectMap [
            rr:parentTriplesMap :FeedMap
        ]
    ] .