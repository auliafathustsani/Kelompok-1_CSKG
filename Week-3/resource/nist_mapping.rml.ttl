@prefix rr: <http://www.w3.org/ns/r2rml#> .
@prefix rml: <http://semweb.mmlab.be/ns/rml#> .
@prefix ql: <http://semweb.mmlab.be/ns/ql#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .

# Prefiks Kustom untuk Konsep Security Control
@prefix sc: <http://example.org/ontology/security-control#> .

# Base URI untuk memudahkan pembuatan IRI
@base <http://example.org/nist80053/> .

# =================================================================
# Triples Map 1: Control Group (Grup Kontrol)
# Iterator: $.catalog.groups[*]
# =================================================================
<#ControlGroupMap>
  a rr:TriplesMap;

  # 1. Logical Source (Sumber Data)
  rml:logicalSource [
    # Nama file JSON sumber
    rml:source "NIST_SP-800-53_rev5_catalog.json";
    rml:referenceFormulation ql:JSONPath;
    # Iterator: Mengulang setiap objek 'groups' di dalam 'catalog'
    rml:iterator "$.catalog.groups[*]"
  ];

  # 2. Subject Map (Pembuatan Subjek / IRI Entitas)
  rr:subjectMap [
    # Template: Membuat IRI unik berdasarkan ID Grup (misalnya: 'AC', 'AU', dll.)
    rr:template "http://example.org/nist80053/group/{id}";
    rr:class sc:ControlGroup
  ];

  # 3. Predicate-Object Maps (Pemetaan Properti)

  # Property: rdfs:label (Nama/Judul Grup)
  rr:predicateObjectMap [
    rr:predicate rdfs:label;
    rr:objectMap [
      # Mengambil nilai dari kunci 'title'
      rml:reference "title";
      rr:datatype xsd:string
    ]
  ];

  # Property: sc:groupDescription (Deskripsi Grup)
  rr:predicateObjectMap [
    rr:predicate sc:groupDescription;
    rr:objectMap [
      # Mengambil nilai dari kunci 'title'
      rml:reference "description";
      rr:datatype xsd:string
    ]
  ].


# =================================================================
# Triples Map 2: Security Control (Kontrol Keamanan)
# Iterator: $.catalog.groups[*].controls[*]
# =================================================================
<#ControlMap>
  a rr:TriplesMap;

  # 1. Logical Source (Sumber Data)
  rml:logicalSource [
    rml:source "NIST_SP-800-53_rev5_catalog.json";
    rml:referenceFormulation ql:JSONPath;
    # Iterator: Mengulang setiap objek 'controls' di dalam setiap 'groups'
    rml:iterator "$.catalog.groups[*].controls[*]"
  ];

  # 2. Subject Map (Pembuatan Subjek / IRI Entitas)
  rr:subjectMap [
    # Template: Membuat IRI unik berdasarkan ID Kontrol (misalnya: 'AC-1', 'AC-2', dll.)
    rr:template "http://example.org/nist80053/control/{id}";
    rr:class sc:SecurityControl
  ];

  # 3. Predicate-Object Maps (Pemetaan Properti)

  # Property: sc:hasControlID (ID Kontrol)
  rr:predicateObjectMap [
    rr:predicate sc:hasControlID;
    rr:objectMap [
      rml:reference "id";
      rr:datatype xsd:string
    ]
  ];

  # Property: rdfs:label (Nama/Judul Kontrol)
  rr:predicateObjectMap [
    rr:predicate rdfs:label;
    rr:objectMap [
      rml:reference "title";
      rr:datatype xsd:string
    ]
  ];

  # Property: sc:hasClass (Kelas Kontrol, misal: 'SP800-53')
  # Prop adalah array, kita ambil elemen pertama yang bernama 'class'
  rr:predicateObjectMap [
    rr:predicate sc:hasClass;
    rr:objectMap [
      rml:reference "props[?(@.name=='class')].value";
      rr:datatype xsd:string
    ]
  ].