@prefix rr: <http://www.w3.org/ns/r2rml#> .
@prefix rml: <http://semweb.mmlab.be/ns/rml#> .
@prefix ql: <http://semweb.mmlab.be/ns/ql#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

# Definisi Prefiks Kustom untuk Ontologi (Contoh: Threat Intelligence)
@prefix ti: <http://example.org/ontology/threat-intelligence#> .

# Base URI untuk memudahkan pembuatan IRI
@base <http://example.org/misp/mapping/> .

# =================================================================
# Triples Map untuk Entitas MISP Feed
# =================================================================
<#FeedTriplesMap>
  a rr:TriplesMap;

  # 1. Logical Source (Sumber Data)
  rml:logicalSource [
    # Nama file JSON yang diunggah
    rml:source "misp.json";
    # Menggunakan JSONPath sebagai formula referensi
    rml:referenceFormulation ql:JSONPath;
    # Iterator: Mengulang setiap objek 'Feed' di dalam array JSON
    # Struktur: [$] (array root) -> [*] (semua item array) -> .Feed (ambil kunci 'Feed' di dalamnya)
    rml:iterator "$[*].Feed"
  ];

  # 2. Subject Map (Pembuatan Subjek / IRI Entitas)
  rr:subjectMap [
    # Template: Membuat IRI unik berdasarkan URL feed (mengasumsikan URL unik)
    rr:template "http://example.org/resource/feed/{url}";
    # Tipe/Kelas RDF yang ditetapkan
    rr:class ti:ThreatIntelligenceFeed
  ];

  # 3. Predicate-Object Maps (Pemetaan Properti Data)

  # Property: ti:hasName (nama feed)
  rr:predicateObjectMap [
    rr:predicate ti:hasName;
    rr:objectMap [
      # Mengambil nilai dari kunci 'name' relatif terhadap iterator
      rml:reference "name";
      rr:datatype xsd:string
    ]
  ];

  # Property: ti:hasProvider (penyedia feed)
  rr:predicateObjectMap [
    rr:predicate ti:hasProvider;
    rr:objectMap [
      rml:reference "provider";
      rr:datatype xsd:string
    ]
  ];

  # Property: ti:hasURL (URL feed)
  rr:predicateObjectMap [
    rr:predicate ti:hasURL;
    rr:objectMap [
      rml:reference "url";
      # TermType: Dinyatakan sebagai IRI, bukan literal string
      rr:termType rr:IRI
    ]
  ];

  # Property: ti:isEnabled (status aktif/non-aktif)
  rr:predicateObjectMap [
    rr:predicate ti:isEnabled;
    rr:objectMap [
      rml:reference "enabled";
      # Datatype: Dinyatakan sebagai boolean
      rr:datatype xsd:boolean
    ]
  ].

# =================================================================
# Triples Map untuk Entitas Tag (Opsional)
# =================================================================
<#TagTriplesMap>
  a rr:TriplesMap;

  # 1. Logical Source
  rml:logicalSource [
    rml:source "misp.json";
    rml:referenceFormulation ql:JSONPath;
    # Iterator: Mengulang setiap objek 'Tag' yang ada di array
    rml:iterator "$[*].Tag"
  ];

  # 2. Subject Map
  rr:subjectMap [
    # Membuat IRI unik berdasarkan nama tag
    rr:template "http://example.org/resource/tag/{name}";
    rr:class ti:Tag
  ];

  # 3. Predicate-Object Maps

  # Property: ti:tagName
  rr:predicateObjectMap [
    rr:predicate ti:tagName;
    rr:objectMap [
      rml:reference "name";
      rr:datatype xsd:string
    ]
  ].